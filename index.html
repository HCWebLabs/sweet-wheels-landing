<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sweet Wheels — Sweet Deals! | Today’s Route</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@400;600;700;800&family=Poppins:wght@500;600;700&display=swap">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <!-- Leaflet (FREE) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

  <style>
    :root{
      --pink:#ffe8f1; --mint:#e3fff7; --lemon:#fff4cf; --sky:#eaf6ff; --lilac:#f1eaff;
      --ink:#273049; --muted:#5d6b86; --subtle:#7a87a0;
      --ctaStart:#ffbedc; --ctaEnd:#cdbbff; --cta-ink:#1a2340;
      --card:#ffffffee; --card-brd:#00000010; --white:#fff;
      --shadow:0 14px 38px rgba(24,33,56,.14);
      --radius:24px; --ring:0 0 0 3px rgba(169,139,255,.32);
      --container:1200px;

      --v-gap: 28px; --v-gap-lg: 64px;
      --hero-pad: clamp(16px, 6vw, 56px);
    }

    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--ink);}

    /* Pastel backdrop */
    body::before{content:"";position:fixed;inset:0;z-index:-2;background:linear-gradient(180deg,var(--pink),var(--mint) 40%,var(--sky) 75%,var(--lilac));}
    body::after{content:"";position:fixed;inset:-10% -5% auto -5%;height:70vh;z-index:-1;background:
      radial-gradient(ellipse at 20% 20%, rgba(255,218,236,.75), transparent 55%),
      radial-gradient(ellipse at 85% 30%, rgba(201,182,255,.58), transparent 52%),
      radial-gradient(ellipse at 50% 80%, rgba(223,252,246,.62), transparent 52%);
    }

    a{color:inherit}
    .container{max-width:var(--container);margin:0 auto;padding:clamp(14px,3vw,24px)}
    .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
    .subtle{color:var(--subtle);font-size:.95rem}

    /* Skip link */
    .skip-link{position:absolute;left:-9999px;top:auto;overflow:hidden}
    .skip-link:focus{left:16px;top:16px;background:#fff;padding:10px 14px;border-radius:10px;border:1px solid var(--card-brd);box-shadow:var(--shadow);z-index:100}

    /* Slim header */
    header.lp{background:transparent;border-bottom:none;padding-block:6px}
    .lp-bar{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .brand{font-family:Pacifico,cursive;font-size:clamp(20px,3.4vw,30px);color:#ff7fb5;display:inline-flex;align-items:center;gap:8px;text-decoration:none;line-height:1}
    .social{display:flex;align-items:center;gap:10px}
    .social a{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:999px;background:#fff;border:1px solid var(--card-brd);box-shadow:var(--shadow);transition:transform .18s ease}
    .social a i{font-size:16px;color:#25324d}
    .social a:where(:hover,:focus-visible){transform:translateY(-1px) scale(1.03)}
    .social a:focus-visible{outline:none;box-shadow:var(--shadow),var(--ring)}

    /* HERO */
    .hero{display:grid;row-gap:clamp(12px,2.8vw,22px);text-align:center;padding-top:var(--hero-pad);padding-bottom:var(--hero-pad)}
    .headline{display:grid;gap:clamp(10px,2.6vw,24px);justify-items:center}
    .eyebrow{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;background:linear-gradient(90deg,#fff,var(--lilac));border:1px solid var(--card-brd);border-radius:999px;box-shadow:var(--shadow)}
    h1{font-family:Pacifico,cursive;font-weight:400;font-size:clamp(38px,9vw,78px);line-height:1.02;margin:.2rem 0 .3rem}
    h1 .accent{color:#ff7fb5;text-shadow:0 1px 0 rgba(255,255,255,.6);}
    .lead{color:var(--muted);max-width:68ch;margin:0 auto}
    .hero-cta{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:clamp(12px,2.4vw,22px)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:.8rem 1.1rem;border-radius:999px;border:1px solid var(--card-brd);box-shadow:var(--shadow);text-decoration:none;font-weight:800}
    .btn-cta{background:linear-gradient(90deg,var(--ctaStart),var(--ctaEnd));color:var(--cta-ink)}
    .btn-ghost{background:#fff;color:#28324d}

    /* Map + Shots */
    .panel{display:grid;gap:22px}
    @media (min-width:980px){.panel{grid-template-columns:1.2fr .8fr}}
    .card{background:var(--card);border:1px solid var(--card-brd);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}

    .map-card #map{display:none;width:100%;aspect-ratio:16/10;border-radius:16px;border:1px solid var(--card-brd)}
    .map-card #map-skeleton{
      width:100%;aspect-ratio:16/10;border-radius:16px;border:1px dashed #e0d7ff;
      display:grid;place-items:center;color:#7f8aa3;
      background:repeating-linear-gradient(45deg,#fafaff,#fafaff 10px,#f5f2ff 10px,#f5f2ff 20px)
    }
    .map-card.map-ready #map{display:block}
    .map-card.map-ready #map-skeleton{display:none}

    /* Sweet Shots grid */
    .shots-grid{--cols:2;display:grid;gap:8px;grid-template-columns:repeat(var(--cols),1fr);list-style:none;margin:0;padding:0}
    .shots-grid li{list-style:none}
    .shots-grid figure{position:relative;margin:0;aspect-ratio:1/1;border-radius:12px;overflow:hidden;border:1px solid var(--card-brd);background:#fff}
    .shots-grid img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;transition:transform .25s ease}
    .shots-grid figure:hover img{transform:scale(1.04)}
    .shots-grid figcaption{display:none}
    @media (min-width:640px){ .shots-grid{ --cols:4; } }
    @media (min-width:980px){ .shots-grid{ --cols:3; } }
    .show-toggle{display:none;margin-top:8px}
    @media (max-width:979px){
      .show-toggle{display:inline-flex}
      .shots-grid.collapsible:not(.expanded)>li:nth-child(n+5){display:none}
    }

    /* --- SPIN SECTION (Instructions first; Tablet symmetry/centering) --- */
    .spin{margin-top:var(--v-gap-lg)}
    .spin h2{text-align:center;margin:0 0 14px}
    .spin-grid{
      display:grid;
      grid-template-columns:1fr;       /* stacked by default */
      gap:20px;
    }
    .spin-instructions{ order:1; }
    .spin-wheel{ order:2; justify-self:center; }

    /* TABLET: both blocks same width, centered, and spinner slightly larger */
    @media (min-width:640px) and (max-width:979px){
      .spin-grid{
        max-width: 900px;              /* <— shared width for BOTH cards */
        margin-inline: auto;           /* center the stack */
      }
      .spin-instructions,
      .spin-wheel{ width:100%; justify-self:center; }
      #spinner-pastel-air{
        --radius: clamp(300px, 54vmin, 420px); /* bigger wheel on tablet */
        padding: 22px 14px;                   /* tighter horizontal padding */
      }
    }

    /* DESKTOP: 2 columns, instructions | spinner */
    @media (min-width:980px){
      .spin-grid{
        grid-template-columns:1.2fr .8fr;
        align-items:center;
        max-width:100%;
      }
      .spin-instructions{ order:1; }
      .spin-wheel{ order:2; justify-self:center; }
    }

    /* Spinner component */
    #spinner-pastel-air{
      --bg1:#fffafe; --bg2:#f6fbff; --ink:#24324a; --muted:#6881a9; --accent:#ff92ae;
      --ui-font:"Poppins", Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
      --btn-font-size:.95rem; --readout-font-size:.95rem;
      --pointer-size:34px;
      --radius:clamp(220px, 42vmin, 360px);     /* default (mobile/desktop) */
      --cap-size:clamp(42px, calc(var(--radius) * 0.09), 58px);
      display:grid;place-items:center;gap:18px;padding:28px;border-radius:20px;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      font-family:var(--ui-font);color:var(--ink);
    }
    #spinner-pastel-air .wheel-stack{position:relative;width:var(--radius);height:var(--radius);display:grid;place-items:center;background:radial-gradient(120% 120% at 30% 15%, #fff, #f3f6ff 60%);border-radius:50%;box-shadow:0 18px 38px rgba(40,60,120,.18),inset 0 4px 10px rgba(255,255,255,.8),inset 0 -10px 18px rgba(160,180,220,.25)}
    #spinner-pastel-air .inner-ring{position:absolute;inset:10px;border-radius:50%;box-shadow: inset 0 0 0 10px #ffffffaa;pointer-events:none;z-index:1}
    #spinner-pastel-air canvas{width:calc(100% - 22px);height:calc(100% - 22px);border-radius:50%;display:block;z-index:2;position:relative;background:radial-gradient(78% 78% at 50% 45%, #ffffff 0%, #f3f6ff 65%, #eaf1ff 100%)}
    #spinner-pastel-air .pointer{position:absolute;top:-12px;left:50%;translate:-50% 0;font-size:var(--pointer-size);color:var(--accent);line-height:1;text-shadow:0 1px 0 #fff,0 -1px 0 #fff,1px 0 0 #fff,-1px 0 0 #fff,0 6px 14px rgba(255,130,170,.35);pointer-events:none;z-index:10}
    #spinner-pastel-air .cap{position:absolute;width:var(--cap-size);height:var(--cap-size);border-radius:50%;background:radial-gradient(circle at 35% 30%, #fff2c8, #ffc3de 55%, #b9d6ff 100%);border:3px solid #fff;z-index:5;pointer-events:none;box-shadow:inset 0 0 10px rgba(255,255,255,.7), 0 6px 18px rgba(140,165,210,.35)}
    #spinner-pastel-air .controls{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:8px}
    #spinner-pastel-air .btn{background:linear-gradient(180deg,#ffd6a5,#ffb5d6);color:#21304a;border:1px solid rgba(36,50,74,.15);border-radius:999px;padding:.7rem 1.05rem;font-weight:700;font-size:var(--btn-font-size);letter-spacing:.2px;cursor:pointer;transition:.18s;box-shadow:0 12px 18px rgba(255,182,214,.35)}
    #spinner-pastel-air .btn:hover{transform:translateY(-1px);filter:saturate(1.05) brightness(1.04)}
    #spinner-pastel-air .btn[disabled]{opacity:.6;cursor:not-allowed}
    #spinner-pastel-air .readout{background:#fff;padding:.55rem .9rem;border-radius:999px;box-shadow:0 6px 16px rgba(150,170,210,.25);color:var(--ink);font-size:var(--readout-font-size)}
    #spinner-pastel-air .readout strong{color:#0e1b2f};
			
			/* === Spin section: centered, equal-width cards on mobile & tablet === */

/* Mobile (≤639px): narrow stack, centered */
@media (max-width: 639px){
  .spin-grid{
    max-width: min(540px, 92vw);   /* same width for BOTH cards */
    margin-inline: auto;           /* center the stack */
    gap: 20px;
  }
  .spin-instructions,
  .spin-wheel{
    width: 100%;
    justify-self: center;
  }
  /* Slightly smaller wheel on mobile, tighter padding */
  #spinner-pastel-air{
    --radius: clamp(240px, 70vw, 320px);
    padding: 20px 14px;
  }
}

/* Tablet (640–979px): bigger than mobile, smaller than desktop */
@media (min-width: 640px) and (max-width: 979px){
  .spin-grid{
    max-width: 760px;              /* shared width for BOTH cards */
    margin-inline: auto;           /* centered */
    gap: 22px;
  }
  .spin-instructions,
  .spin-wheel{
    width: 100%;
    justify-self: center;
  }
  /* Larger wheel on tablet, reduced side padding to breathe */
  #spinner-pastel-air{
    --radius: clamp(300px, 56vmin, 420px);
    padding: 22px 16px;
  }
}

  </style>
</head>
<body id="top">
  <a href="#main" class="skip-link">Skip to content</a>

  <header class="lp" role="banner">
    <div class="container lp-bar">
      <a class="brand" href="#top"><i class="fa-solid fa-ice-cream" aria-hidden="true"></i><span>Sweet Wheels</span></a>
      <div class="social" aria-label="Social links">
        <a href="#" aria-label="Instagram" target="_blank" rel="noopener"><i class="fa-brands fa-instagram"></i></a>
        <a href="#" aria-label="TikTok" target="_blank" rel="noopener"><i class="fa-brands fa-tiktok"></i></a>
        <a href="#" aria-label="Facebook" target="_blank" rel="noopener"><i class="fa-brands fa-facebook-f"></i></a>
      </div>
    </div>
  </header>

  <main id="main" class="container" role="main">
    <!-- HERO -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="headline">
        <div class="eyebrow">Today only • Knoxville route</div>
        <h1 id="hero-title">Sweet Wheels, <span class="accent">Sweet Deals!</span></h1>
        <p class="lead">Find the truck on today’s route and grab a dessert deal. One tap to open Maps, one spin to save.</p>
      </div>
      <div class="hero-cta">
        <a class="btn btn-cta" href="#route"><i class="fa-solid fa-map"></i> Open in Maps</a>
        <a class="btn btn-ghost" href="#spin"><i class="fa-solid fa-gift"></i> Spin to Win!</a>
      </div>
    </section>

    <!-- MAP + SWEET SHOTS -->
    <section class="panel" id="route" aria-label="Today’s route and Sweet Shots">
      <article class="card map-card" id="route-card">
        <h2>Today’s Route</h2>
        <div class="map-skeleton" id="map-skeleton" aria-hidden="true">Loading map…</div>
        <div id="map" role="region" aria-label="Live map with current truck location"></div>
        <p class="subtle">Follow our Instagram Stories for live updates and pop-up stops.</p>
        <a class="btn btn-ghost" id="maps-link" href="#" target="_blank" rel="noopener"><i class="fa-solid fa-location-dot"></i> Open in Maps</a>
      </article>

      <aside class="card" aria-label="Sweet Shots from our community">
        <h2 class="sr-only">Sweet Shots</h2>
        <ul class="shots-grid" role="list" id="shots"></ul>
        <button class="btn btn-ghost show-toggle" id="shots-toggle" type="button"
                aria-controls="shots" aria-expanded="false">
          See more
        </button>
        <p class="subtle" style="margin-top:8px">Tag <strong>#SweetWheelsKnox</strong> to be featured.</p>
      </aside>
    </section>

    <!-- SPIN SECTION -->
    <section class="spin" id="spin" aria-labelledby="spin-title">
      <h2 id="spin-title">Spin to Win a Sweet Deal</h2>

      <div class="spin-grid">
        <!-- Instructions FIRST -->
        <aside class="card spin-instructions" aria-label="Offer details">
          <h3>How it works</h3>
          <ol>
            <li>Tap <strong>SPIN</strong>.</li>
            <li>Show the winning message at checkout.</li>
            <li>One spin per guest • Select items • Not combinable.</li>
          </ol>
          <a class="btn btn-cta" href="#route"><i class="fa-solid fa-map"></i> Find Today’s Stop</a>
        </aside>

        <!-- Spinner SECOND -->
        <section id="spinner-pastel-air" class="spin-wheel" aria-label="Dessert discount spinner">
          <div class="wheel-stack">
            <i class="fa-solid fa-caret-down pointer" aria-hidden="true"></i>
            <span class="inner-ring" aria-hidden="true"></span>
            <canvas id="wheel6" aria-hidden="true"></canvas>
            <div class="cap" aria-hidden="true"></div>
          </div>

          <div class="controls">
            <button class="btn" id="spin6"><i class="fa-solid fa-rotate"></i> Spin</button>
            <span class="readout" role="status" aria-live="polite" id="status6">Ready.</span>
          </div>
        </section>
      </div>
    </section>
  </main>

  <footer class="container" role="contentinfo">
    <p><strong>Sweet Wheels</strong> · Knoxville, TN · <a href="mailto:hello@sweetwheels.example">hello@sweetwheels.example</a></p>
  </footer>

  <script>
  /* ---- CONFIG ---- */
  const LIVE_LOCATION = { lat: 35.9606, lng: -83.9207, label: "Downtown Knoxville" }; // sample
  const SHOTS = [
    {src:"https://placehold.co/600x600/png?text=Mint+Chip",alt:"Customer photo: mint chip cone"},
    {src:"https://placehold.co/600x600/png?text=Banana+Split",alt:"Customer photo: banana split"},
    {src:"https://placehold.co/600x600/png?text=Strawberry+Sundae",alt:"Customer photo: strawberry sundae"},
    {src:"https://placehold.co/600x600/png?text=Chocolate+Shake",alt:"Customer photo: chocolate shake"},
    {src:"https://placehold.co/600x600/png?text=Vanilla+Swirl",alt:"Customer photo: vanilla swirl"},
    {src:"https://placehold.co/600x600/png?text=Cookie+Dough",alt:"Customer photo: cookie dough scoop"},
    {src:"https://placehold.co/600x600/png?text=Blueberry+Cone",alt:"Customer photo: blueberry cone"},
    {src:"https://placehold.co/600x600/png?text=Pistachio+Scoop",alt:"Customer photo: pistachio scoop"},
    {src:"https://placehold.co/600x600/png?text=Caramel+Swirl",alt:"Customer photo: caramel swirl"},
    {src:"https://placehold.co/600x600/png?text=Rainbow+Sprinkles",alt:"Customer photo: cone with rainbow sprinkles"},
    {src:"https://placehold.co/600x600/png?text=Cookies+%26+Cream",alt:"Customer photo: cookies and cream"},
    {src:"https://placehold.co/600x600/png?text=Peach+Sorbet",alt:"Customer photo: peach sorbet"}
  ];

  /* ---- Sweet Shots render ---- */
  const shotsEl = document.getElementById('shots');
  SHOTS.forEach(({src,alt})=>{
    const li=document.createElement('li');
    li.innerHTML=`<figure><img loading="lazy" src="${src}" alt="${alt}" width="600" height="600"><figcaption class="sr-only">${alt}</figcaption></figure>`;
    shotsEl.appendChild(li);
  });

  /* ---- Collapse: Mobile + Tablet (≤979px) ---- */
  const toggleBtn   = document.getElementById('shots-toggle');
  const mqlCollapse = window.matchMedia('(max-width: 979px)');
  function updateShotsToggle(){
    if (mqlCollapse.matches){
      shotsEl.classList.add('collapsible');
      if (!shotsEl.classList.contains('expanded')) {
        toggleBtn.textContent = 'See more';
        toggleBtn.setAttribute('aria-expanded','false');
      } else {
        toggleBtn.textContent = 'See less';
        toggleBtn.setAttribute('aria-expanded','true');
      }
      toggleBtn.hidden = SHOTS.length <= 4;
    } else {
      shotsEl.classList.remove('collapsible','expanded');
      toggleBtn.hidden = true;
    }
  }
  toggleBtn.addEventListener('click', ()=>{ shotsEl.classList.toggle('expanded'); updateShotsToggle(); });
  mqlCollapse.addEventListener('change', updateShotsToggle);
  updateShotsToggle();

  /* ---- Map (lazy init) ---- */
  const mapCard=document.getElementById('route-card');
  const mapEl=document.getElementById('map');
  const mapsLink=document.getElementById('maps-link');
  mapsLink.href=`https://www.google.com/maps/search/?api=1&query=${LIVE_LOCATION.lat}%2C${LIVE_LOCATION.lng}`;
  let mapInited=false;
  const obs=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting&&!mapInited){initMap();mapInited=true;obs.disconnect();}});},{threshold:0.2});
  obs.observe(mapCard);
  function initMap(){
    mapCard.classList.add('map-ready');
    const map=L.map(mapEl,{scrollWheelZoom:false,attributionControl:true}).setView([LIVE_LOCATION.lat,LIVE_LOCATION.lng],13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);
    L.marker([LIVE_LOCATION.lat,LIVE_LOCATION.lng]).addTo(map).bindPopup(`<strong>Sweet Wheels</strong><br>${LIVE_LOCATION.label}`).openPopup();
    new ResizeObserver(()=>map.invalidateSize()).observe(mapEl);
  }

  /* ===== Spinner logic (unchanged) ===== */
  (() => {
    const slices = [
      { label:'10% Off',             color:'#FFE2AF' },
      { label:'15% Off',             color:'#C6F0D0' },
      { label:'20% Off',             color:'#FFD99A' },
      { label:'BOGO 50% Off',        color:'#D6D4FF' },
      { label:'Free Topping',        color:'#FFC9D8' },
      { label:'Free Small Dessert',  color:'#B9E6FF' },
    ];
    const N = slices.length;
    const LABEL_FONT_FAMILY = '"Poppins", Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans"';
    const LABEL_FONT_WEIGHT = 600;
    const LABEL_SCALE = 0.088;
    const LABEL_MIN_PX = 11;
    const LINE_HEIGHT_RATIO = 1.2;

    const canvas  = document.getElementById('wheel6');
    const ctx     = canvas.getContext('2d', { alpha:true });
    const spinBtn = document.getElementById('spin6');
    const status  = document.getElementById('status6');

    const TAU = Math.PI * 2;
    const pointerAngle = -Math.PI / 2;
    const TURNS_MIN = 6, TURNS_MAX = 8;
    const INNER_DOT_RATIO = 0.12;

    let rotation = 0, spinning = false, highlightIndex = null;

    function resizeCanvas(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const { width, height } = canvas.getBoundingClientRect();
      canvas.width = Math.round(width * dpr);
      canvas.height = Math.round(height * dpr);
      ctx.setTransform(1,0,0,1,0,0);
      ctx.scale(dpr, dpr);
      draw();
    }
    new ResizeObserver(resizeCanvas).observe(canvas);

    const normalize = a => ((a % TAU) + TAU) % TAU;
    const rand = () => (crypto?.getRandomValues ? (crypto.getRandomValues(new Uint32Array(1))[0]+1)/4294967297 : Math.random());

    function textColor(hex){
      const c = hex.replace('#','');
      const r = parseInt(c.slice(0,2),16)||255,
            g = parseInt(c.slice(2,4),16)||255,
            b = parseInt(c.slice(4,6),16)||255;
      const L = 0.2126*r + 0.7152*g + 0.0722*b;
      return L > 170 ? '#24324a' : '#ffffff';
    }

    function wrapText(ctx, text, x, y, maxWidth, lineHeight){
      const words = text.split(' '); let line=''; const lines=[];
      for (let n=0;n<words.length;n++){
        const test = line + (line ? ' ' : '') + words[n];
        if (ctx.measureText(test).width > maxWidth && line){ lines.push(line); line = words[n]; }
        else { line = test; }
      }
      lines.push(line);
      const totalH = lines.length * lineHeight;
      let yy = y - totalH/2 + lineHeight/2;
      for (const ln of lines){ ctx.fillText(ln, x, yy); yy += lineHeight; }
    }

    function draw(){
      const { width, height } = canvas.getBoundingClientRect();
      const cx = width/2, cy = height/2;
      const r = Math.min(width, height)/2 - 6;

      ctx.clearRect(0,0,width,height);
      ctx.save(); ctx.translate(cx,cy); ctx.rotate(rotation);

      const step = TAU / N;
      for (let i=0;i<N;i++){
        const a0 = i*step, a1=a0+step, mid=a0+step/2;

        ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,r,a0,a1,false); ctx.closePath();
        ctx.fillStyle = slices[i].color; ctx.fill();
        ctx.strokeStyle='rgba(30,48,90,.20)'; ctx.lineWidth=2; ctx.stroke();

        ctx.save();
        ctx.rotate(mid); ctx.translate(r*0.60, 0); ctx.rotate(Math.PI/2);
        ctx.fillStyle = textColor(slices[i].color);
        const base = Math.max(LABEL_MIN_PX, Math.round(r * LABEL_SCALE));
        ctx.font = `${LABEL_FONT_WEIGHT} ${base}px ${LABEL_FONT_FAMILY}`;
        ctx.textAlign='center'; ctx.textBaseline='middle';
        wrapText(ctx, slices[i].label, 0, 0, r*0.50, Math.round(base*LINE_HEIGHT_RATIO));
        ctx.restore();
      }

      if (highlightIndex !== null){
        const start = highlightIndex*step + 0.08;
        const end   = (highlightIndex+1)*step - 0.08;
        ctx.save();
        ctx.beginPath(); ctx.arc(0,0,r-4, start, end);
        ctx.strokeStyle = '#FFC9A6';
        ctx.shadowColor = 'rgba(255,180,140,.55)';
        ctx.shadowBlur = 10; ctx.lineWidth = 6; ctx.stroke();
        ctx.restore();
      }

      if (INNER_DOT_RATIO > 0){
        ctx.beginPath(); ctx.arc(0,0,r * INNER_DOT_RATIO, 0, TAU);
        ctx.fillStyle='rgba(255,255,255,.60)'; ctx.fill();
      }

      ctx.restore();
    }

    function spin(){
      if (spinning) return;
      spinning = true; spinBtn.disabled = true; status.textContent = 'Spinning…';
      highlightIndex = null; draw();

      const winner = Math.floor(rand() * N);
      const step = TAU / N;
      const centerAngle = winner*step + step/2;

      const turns = TURNS_MIN + Math.floor(rand() * (TURNS_MAX - TURNS_MIN + 1));
      const rmod = normalize(rotation);
      const alignDelta = (pointerAngle - centerAngle) - rmod;
      const target = rotation + (turns*TAU) + alignDelta;

      animateTo(rotation, target, 4200 + rand()*800, t => 1 - Math.pow(1 - t, 5), () => {
        rotation = normalize(pointerAngle - centerAngle);
        const under = normalize(pointerAngle - rotation);
        const landed = Math.floor(under / step) % N;

        highlightIndex = landed; draw();
        status.innerHTML = `Winner: <strong>${slices[landed].label}</strong>`;
        spinning = false; spinBtn.disabled = false;
      });
    }

    function animateTo(from, to, duration, ease, done){
      const t0 = performance.now();
      function frame(now){
        const t = Math.min(1, (now - t0)/duration);
        rotation = from + (to - from) * ease(t);
        draw();
        if (t < 1) requestAnimationFrame(frame); else done && done();
      }
      requestAnimationFrame(frame);
    }

    const canvasEl = document.getElementById('wheel6');
    canvasEl.style.width='100%'; canvasEl.style.height='100%';
    document.getElementById('spin6').addEventListener('click', spin);
    requestAnimationFrame(resizeCanvas);
    document.fonts?.ready.then(() => requestAnimationFrame(resizeCanvas));
  })();
  </script>
</body>
</html>
